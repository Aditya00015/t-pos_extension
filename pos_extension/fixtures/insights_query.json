[
 {
  "chart": "sjv031de3n",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.025,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-05-22 07:52:18.495504",
  "limit": 500,
  "modified": "2024-05-21 16:33:40.372826",
  "name": "QRY-0001",
  "result_name": "sjv1rs3c2s",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n LIMIT 100",
  "status": "Execution Successful",
  "tables": [],
  "title": "Total Customers Visual Query",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "skgqcgg072",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.08,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Lead Source\",\n   \"column\": \"lead_source\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Lead Source\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-16 17:01:56.074594",
  "limit": 500,
  "modified": "2024-05-22 16:36:49.713546",
  "name": "QRY-0003",
  "result_name": "skgrpnm6k8",
  "results_row_count": 6,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.lead_source AS `Lead Source`,\n       count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.lead_source\n LIMIT 100",
  "status": "Execution Successful",
  "tables": [],
  "title": "Lead Source Visual Query",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "skto1ectjm",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.02,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Lead Source\",\n   \"column\": \"lead_source\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Lead Source\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"left\": {\n       \"arguments\": [\n        {\n         \"type\": \"Column\",\n         \"value\": {\n          \"column\": \"name\",\n          \"table\": \"tabCustomer\"\n         }\n        }\n       ],\n       \"function\": \"count\",\n       \"type\": \"CallExpression\"\n      },\n      \"operator\": \"/\",\n      \"right\": {\n       \"arguments\": [\n        {\n         \"type\": \"String\",\n         \"value\": \"SUM(COUNT(*)) OVER ()\"\n        }\n       ],\n       \"function\": \"sql\",\n       \"type\": \"CallExpression\"\n      },\n      \"type\": \"BinaryExpression\"\n     },\n     \"operator\": \"*\",\n     \"right\": {\n      \"type\": \"Number\",\n      \"value\": 100\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"count(`tabCustomer.name`)/sql(\\\"SUM(COUNT(*)) OVER ()\\\")*100\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-05-22 12:59:17.510030",
  "limit": 500,
  "modified": "2024-05-22 08:04:42.361264",
  "name": "QRY-0005",
  "result_name": "sktpujg09d",
  "results_row_count": 4,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.lead_source AS `Lead Source`,\n       count(*) AS `Total Customers`,\n       (count(*) / SUM(COUNT(*)) OVER ()) * 100 AS `Referral Rate`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.lead_source\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Customer Referral Rate Visual Query  ",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "so6e6lfhn2",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.03,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-06-06 11:18:27.063380",
  "limit": 500,
  "modified": "2024-06-06 11:18:27.137308",
  "name": "QRY-0027",
  "result_name": "so6er5aidp",
  "results_row_count": 5,
  "script": null,
  "script_log": null,
  "sql": "SELECT *\n  FROM tabCustomer\n LIMIT 5",
  "status": "Execution Successful",
  "tables": [],
  "title": "Query 0027",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "3i8o93ab1t",
  "columns": [],
  "data_source": null,
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.0,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": null,
  "limit": 500,
  "modified": "2024-07-10 17:02:06.856654",
  "name": "QRY-0080",
  "result_name": "3i8oltrsek",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT transaction_id, COUNT(*)\nFROM transactions\nGROUP BY transaction_id\nHAVING COUNT(*) > 1;\n",
  "status": "Execution Successful",
  "tables": [],
  "title": "Query 0080",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "l7a0l8l5re",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.0,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": null,\n  \"table\": null\n }\n}",
  "last_execution": null,
  "limit": 500,
  "modified": "2024-07-12 14:13:01.333465",
  "name": "QRY-0082",
  "result_name": "l7a00sn4m9",
  "results_row_count": -1,
  "script": null,
  "script_log": null,
  "sql": "",
  "status": "Execution Successful",
  "tables": [],
  "title": "Query 0082",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "ul6d9qahh6",
  "columns": [],
  "data_source": null,
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.0,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": null,\n  \"table\": null\n }\n}",
  "last_execution": null,
  "limit": 500,
  "modified": "2024-07-22 15:49:12.765498",
  "name": "QRY-0084",
  "result_name": "ul6ds1ppq5",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": null,
  "status": "Execution Successful",
  "tables": [],
  "title": "Query 0084",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "sk9os9e458",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.065,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Status\",\n   \"column\": \"status\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Status\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-16 17:01:55.369608",
  "limit": 500,
  "modified": "2024-05-22 08:16:46.911930",
  "name": "QRY-0002",
  "result_name": "sk9opkl4du",
  "results_row_count": 5,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.status AS `Status`,\n       count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.status\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Status of Customer Visual Query",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "sn2i1f2mr6",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 2.055,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-06-06 11:18:01.724771",
  "limit": 500,
  "modified": "2024-06-06 11:18:03.827432",
  "name": "QRY-0026",
  "result_name": "sn2i1c2ked",
  "results_row_count": 1000,
  "script": null,
  "script_log": null,
  "sql": "SELECT *\n  FROM tabCustomer",
  "status": "Execution Successful",
  "tables": [],
  "title": "Query 0026",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "sr2svg2mdt",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.062,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-06-06 11:24:46.272781",
  "limit": 500,
  "modified": "2024-06-06 11:24:46.390156",
  "name": "QRY-0028",
  "result_name": "sr2s0p68j5",
  "results_row_count": 6,
  "script": null,
  "script_log": null,
  "sql": "SELECT *\n  FROM `tabSales Invoice`\n LIMIT 6",
  "status": "Execution Successful",
  "tables": [],
  "title": "Query 0028",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "eipt6uqsjq",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.0,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Pos Invoice Item\",\n  \"table\": \"tabPOS Invoice Item\"\n }\n}",
  "last_execution": null,
  "limit": 500,
  "modified": "2024-07-03 11:47:46.046189",
  "name": "QRY-0079",
  "result_name": "eipu6a3d6h",
  "results_row_count": -1,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabPOS Invoice Item`.*\n  FROM `tabPOS Invoice Item` AS `tabPOS Invoice Item`\n LIMIT 100",
  "status": "Pending Execution",
  "tables": [],
  "title": "Query 0079",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "3jn6rm092v",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.0,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 1,
  "is_stored": 0,
  "json": "{}",
  "last_execution": null,
  "limit": 500,
  "modified": "2024-07-10 17:10:31.513658",
  "name": "QRY-0081",
  "result_name": "3jn7ks4qdo",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": null,
  "status": "Execution Successful",
  "tables": [],
  "title": "Query 0081",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "lb4svaavon",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.0,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": null,\n  \"table\": null\n }\n}",
  "last_execution": null,
  "limit": 500,
  "modified": "2024-07-12 14:20:11.362007",
  "name": "QRY-0083",
  "result_name": "lb4sveulr2",
  "results_row_count": -1,
  "script": null,
  "script_log": null,
  "sql": "",
  "status": "Execution Successful",
  "tables": [],
  "title": "Query 0083",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "j5ntin9onk",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.079,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"left\": {\n       \"arguments\": [\n        {\n         \"left\": {\n          \"type\": \"Column\",\n          \"value\": {\n           \"column\": \"lead_source\",\n           \"table\": \"tabCustomer\"\n          }\n         },\n         \"operator\": \"=\",\n         \"right\": {\n          \"type\": \"String\",\n          \"value\": \"Customer Referral\"\n         },\n         \"type\": \"BinaryExpression\"\n        }\n       ],\n       \"function\": \"count_if\",\n       \"type\": \"CallExpression\"\n      },\n      \"operator\": \"/\",\n      \"right\": {\n       \"arguments\": [\n        {\n         \"type\": \"Column\",\n         \"value\": {\n          \"column\": \"name\",\n          \"table\": \"tabCustomer\"\n         }\n        }\n       ],\n       \"function\": \"count\",\n       \"type\": \"CallExpression\"\n      },\n      \"type\": \"BinaryExpression\"\n     },\n     \"operator\": \"*\",\n     \"right\": {\n      \"type\": \"Number\",\n      \"value\": 100\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"count_if(`tabCustomer.lead_source` = 'Customer Referral')/count(`tabCustomer.name`)*100\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-16 17:01:55.867182",
  "limit": 500,
  "modified": "2024-05-22 16:36:30.616072",
  "name": "QRY-0015",
  "result_name": "j5ntfj7av1",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT (sum(CASE WHEN (`tabCustomer`.lead_source = 'Customer Referral') THEN 1 ELSE 0 END) / count(*)) * 100 AS `Referral Rate`\n  FROM `tabCustomer` AS `tabCustomer`\n LIMIT 100",
  "status": "Execution Successful",
  "tables": [],
  "title": "Customer Referral Rate   ",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "458ceb5flc",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.259,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Franchise Name\",\n   \"column\": \"franchise_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {},\n   \"operator\": {\n    \"label\": null,\n    \"value\": null\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  },\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {},\n   \"operator\": {\n    \"label\": null,\n    \"value\": null\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-01 10:21:57.306131",
  "limit": 500,
  "modified": "2024-05-27 07:37:53.282442",
  "name": "QRY-0017",
  "result_name": "458c27l502",
  "results_row_count": 100,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.franchise_name AS `Franchise Name`,\n       count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.franchise_name\n LIMIT 100",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise(site) wise Customers",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "usugudnq36",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 3.783,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code_name`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-15 11:17:41.213271",
  "limit": 500,
  "modified": "2024-06-12 14:58:24.617996",
  "name": "QRY-0044",
  "result_name": "usug55hb6r",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code_name LIKE '%%refill%%'\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Refill Rate",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "dkie43230p",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.111,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Active Customers\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"left\": {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"status\",\n         \"table\": \"tabCustomer\"\n        }\n       },\n       \"operator\": \"=\",\n       \"right\": {\n        \"type\": \"String\",\n        \"value\": \"Active\"\n       },\n       \"type\": \"BinaryExpression\"\n      }\n     ],\n     \"function\": \"count_if\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"count_if(`tabCustomer.status` = 'Active')\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Active Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"left\": {\n       \"arguments\": [\n        {\n         \"left\": {\n          \"type\": \"Column\",\n          \"value\": {\n           \"column\": \"status\",\n           \"table\": \"tabCustomer\"\n          }\n         },\n         \"operator\": \"=\",\n         \"right\": {\n          \"type\": \"String\",\n          \"value\": \"Active\"\n         },\n         \"type\": \"BinaryExpression\"\n        }\n       ],\n       \"function\": \"count_if\",\n       \"type\": \"CallExpression\"\n      },\n      \"operator\": \"/\",\n      \"right\": {\n       \"arguments\": [\n        {\n         \"type\": \"Column\",\n         \"value\": {\n          \"column\": \"name\",\n          \"table\": \"tabCustomer\"\n         }\n        }\n       ],\n       \"function\": \"count\",\n       \"type\": \"CallExpression\"\n      },\n      \"type\": \"BinaryExpression\"\n     },\n     \"operator\": \"*\",\n     \"right\": {\n      \"type\": \"Number\",\n      \"value\": 100\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"count_if(`tabCustomer.status` = 'Active')/count(`tabCustomer.name`)*100\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"New Customers\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"name\",\n         \"table\": \"tabCustomer\"\n        }\n       }\n      ],\n      \"function\": \"count\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"-\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"left\": {\n         \"type\": \"Column\",\n         \"value\": {\n          \"column\": \"status\",\n          \"table\": \"tabCustomer\"\n         }\n        },\n        \"operator\": \"=\",\n        \"right\": {\n         \"type\": \"String\",\n         \"value\": \"Active\"\n        },\n        \"type\": \"BinaryExpression\"\n       }\n      ],\n      \"function\": \"count_if\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"count(`tabCustomer.name`)-count_if(`tabCustomer.status` = 'Active')\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"New Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-16 17:01:55.668625",
  "limit": 500,
  "modified": "2024-05-22 16:40:04.025278",
  "name": "QRY-0012",
  "result_name": "dkiemv055o",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT count(*) AS `Total Customers`,\n       sum(CASE WHEN (`tabCustomer`.status = 'Active') THEN 1 ELSE 0 END) AS `Active Customers`,\n       (sum(CASE WHEN (`tabCustomer`.status = 'Active') THEN 1 ELSE 0 END) / count(*)) * 100 AS `Referral rate`,\n       count(*) - sum(CASE WHEN (`tabCustomer`.status = 'Active') THEN 1 ELSE 0 END) AS `New Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Referral Rate Visual Query",
  "transforms": [
   {
    "options": "{}",
    "parent": "QRY-0012",
    "parentfield": "transforms",
    "parenttype": "Insights Query",
    "type": ""
   }
  ],
  "variables": []
 },
 {
  "chart": "sknq9lil2u",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.097,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-16 17:01:55.149599",
  "limit": 500,
  "modified": "2024-05-24 09:45:21.737469",
  "name": "QRY-0004",
  "result_name": "sknr5of3hr",
  "results_row_count": 10,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.type_of_customer\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Type of Customer Visual Query",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "spu0kfqs1i",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.339,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Franchise Country\",\n   \"column\": \"franchise_country\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise Country\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer Name\",\n   \"column\": \"customer_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer Group Name\",\n   \"column\": \"customer_group_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Group Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer Group\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Lead Source\",\n   \"column\": \"lead_source\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Lead Source\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Credit Status\",\n   \"column\": \"credit_status\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Credit Status\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Gps Location\",\n   \"column\": \"gps_location\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Gps Location\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Long Text\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Status\",\n   \"column\": \"status\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Status\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer_group\",\n    \"label\": \"customer_group\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"customer_group\"\n   },\n   \"left_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer Group\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer Group\",\n    \"table\": \"tabCustomer Group\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-05-24 16:18:17.402772",
  "limit": 500,
  "modified": "2024-05-24 16:18:02.362233",
  "name": "QRY-0010",
  "result_name": "spu0i7t8ef",
  "results_row_count": 1000,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.franchise_country AS `Franchise Country`,\n       `tabCustomer`.referral_company AS `Referral Company`,\n       `tabCustomer`.customer_name AS `Customer Name`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       `tabCustomer Group`.customer_group_name AS `Customer Group Name`,\n       `tabCustomer`.lead_source AS `Lead Source`,\n       `tabCustomer`.credit_status AS `Credit Status`,\n       `tabCustomer`.gps_location AS `Gps Location`,\n       `tabCustomer`.status AS `Status`\n  FROM `tabCustomer` AS `tabCustomer`\n INNER JOIN `tabCustomer Group` AS `tabCustomer Group`\n    ON `tabCustomer`.customer_group = `tabCustomer Group`.name\n GROUP BY `tabCustomer`.franchise_country,\n          `tabCustomer`.referral_company,\n          `tabCustomer`.customer_name,\n          `tabCustomer`.type_of_customer,\n          `tabCustomer Group`.customer_group_name,\n          `tabCustomer`.lead_source,\n          `tabCustomer`.credit_status,\n          `tabCustomer`.gps_location,\n          `tabCustomer`.status\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Customer List ",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "n4rtmnnsbt",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.068,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-01 10:21:56.974805",
  "limit": 500,
  "modified": "2024-05-24 15:48:03.112439",
  "name": "QRY-0016",
  "result_name": "n4rta25on1",
  "results_row_count": 100,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.referral_company AS `Referral Company`,\n       count(*) AS `Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.referral_company\n LIMIT 100",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise wise Customers",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "be62kjfmbm",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 62.184,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer Name\",\n   \"column\": \"customer_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Account Manager\",\n   \"column\": \"account_manager\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Account Manager\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Average Purchase Time\",\n   \"column\": \"average_purchase_time\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Average Purchase Time\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer Type\",\n   \"column\": \"customer_type\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Type\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Creation Time\",\n   \"column\": \"creation_time\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Month\",\n   \"label\": \"Creation Time\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Datetime\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Credit Status\",\n   \"column\": \"credit_status\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Credit Status\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Default Commission Rate\",\n   \"column\": \"default_commission_rate\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Default Commission Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer Group Name\",\n   \"column\": \"customer_group_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Group Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Address Description\",\n   \"column\": \"address_description\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Address Description\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Text\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Default Price List\",\n   \"column\": \"default_price_list\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Default Price List\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Default Sales Partner\",\n   \"column\": \"default_sales_partner\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Default Sales Partner\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Disabled\",\n   \"column\": \"disabled\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Disabled\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Email Id\",\n   \"column\": \"email_id\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Email Id\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"First Purchase Date\",\n   \"column\": \"first_purchase_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Month\",\n   \"label\": \"First Purchase Date\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Datetime\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Franchise Country\",\n   \"column\": \"franchise_country\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise Country\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Gender\",\n   \"column\": \"gender\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Gender\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Gps Location\",\n   \"column\": \"gps_location\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Gps Location\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Long Text\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Last Purchase Date\",\n   \"column\": \"last_purchase_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Month\",\n   \"label\": \"Last Purchase Date\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Datetime\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Lead Name\",\n   \"column\": \"lead_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Lead Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Lead Source\",\n   \"column\": \"lead_source\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Lead Source\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Loyalty Program\",\n   \"column\": \"loyalty_program\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Loyalty Program\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Loyalty Program Tier\",\n   \"column\": \"loyalty_program_tier\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Loyalty Program Tier\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Market Segment\",\n   \"column\": \"market_segment\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Market Segment\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Mobile No\",\n   \"column\": \"mobile_no\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Mobile No\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Modified Time\",\n   \"column\": \"modified_time\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Month\",\n   \"label\": \"Modified Time\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Datetime\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Next Projected Purchase Date\",\n   \"column\": \"next_projected_purchase_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Month\",\n   \"label\": \"Next Projected Purchase Date\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Date\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Outstanding Amount\",\n   \"column\": \"outstanding_amount\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Outstanding Amount\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Owner\",\n   \"column\": \"owner\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Owner\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Pending Bottles\",\n   \"column\": \"pending_bottles\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Pending Bottles\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Pending Bottles Count\",\n   \"column\": \"pending_bottles_count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Pending Bottles Count\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Posa Discount\",\n   \"column\": \"posa_discount\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Posa Discount\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Primary Address\",\n   \"column\": \"primary_address\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Primary Address\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Text\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 1000000000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-18 20:21:57.417854",
  "limit": 500,
  "modified": "2024-08-18 20:25:03.381093",
  "name": "QRY-0018",
  "result_name": "be62ju736i",
  "results_row_count": 1000,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.customer_name AS `Customer Name`,\n       `tabCustomer`.account_manager AS `Account Manager`,\n       `tabCustomer`.average_purchase_time AS `Average Purchase Time`,\n       `tabCustomer`.customer_type AS `Customer Type`,\n       date_format(`tabCustomer`.creation_time, '%%Y-%%m-01') AS `Creation Time`,\n       `tabCustomer`.credit_status AS `Credit Status`,\n       `tabCustomer`.customer_group_name AS `Customer Group Name`,\n       `tabCustomer`.address_description AS `Address Description`,\n       `tabCustomer`.referral_company AS `Referral Company`,\n       `tabCustomer`.default_price_list AS `Default Price List`,\n       `tabCustomer`.default_sales_partner AS `Default Sales Partner`,\n       `tabCustomer`.email_id AS `Email Id`,\n       date_format(`tabCustomer`.first_purchase_date, '%%Y-%%m-01') AS `First Purchase Date`,\n       `tabCustomer`.franchise_country AS `Franchise Country`,\n       `tabCustomer`.gender AS `Gender`,\n       `tabCustomer`.gps_location AS `Gps Location`,\n       date_format(`tabCustomer`.last_purchase_date, '%%Y-%%m-01') AS `Last Purchase Date`,\n       `tabCustomer`.lead_name AS `Lead Name`,\n       `tabCustomer`.lead_source AS `Lead Source`,\n       `tabCustomer`.loyalty_program AS `Loyalty Program`,\n       `tabCustomer`.loyalty_program_tier AS `Loyalty Program Tier`,\n       `tabCustomer`.market_segment AS `Market Segment`,\n       `tabCustomer`.mobile_no AS `Mobile No`,\n       date_format(`tabCustomer`.modified_time, '%%Y-%%m-01') AS `Modified Time`,\n       date_format(`tabCustomer`.next_projected_purchase_date, '%%Y-%%m-01') AS `Next Projected Purchase Date`,\n       `tabCustomer`.owner AS `Owner`,\n       `tabCustomer`.pending_bottles AS `Pending Bottles`,\n       `tabCustomer`.primary_address AS `Primary Address`,\n       sum(`tabCustomer`.default_commission_rate) AS `Default Commission Rate`,\n       sum(`tabCustomer`.disabled) AS `Disabled`,\n       sum(`tabCustomer`.outstanding_amount) AS `Outstanding Amount`,\n       sum(`tabCustomer`.pending_bottles_count) AS `Pending Bottles Count`,\n       sum(`tabCustomer`.posa_discount) AS `Posa Discount`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.customer_name,\n          `tabCustomer`.account_manager,\n          `tabCustomer`.average_purchase_time,\n          `tabCustomer`.customer_type,\n          date_format(`tabCustomer`.creation_time, '%%Y-%%m-01'),\n          `tabCustomer`.credit_status,\n          `tabCustomer`.customer_group_name,\n          `tabCustomer`.address_description,\n          `tabCustomer`.referral_company,\n          `tabCustomer`.default_price_list,\n          `tabCustomer`.default_sales_partner,\n          `tabCustomer`.email_id,\n          date_format(`tabCustomer`.first_purchase_date, '%%Y-%%m-01'),\n          `tabCustomer`.franchise_country,\n          `tabCustomer`.gender,\n          `tabCustomer`.gps_location,\n          date_format(`tabCustomer`.last_purchase_date, '%%Y-%%m-01'),\n          `tabCustomer`.lead_name,\n          `tabCustomer`.lead_source,\n          `tabCustomer`.loyalty_program,\n          `tabCustomer`.loyalty_program_tier,\n          `tabCustomer`.market_segment,\n          `tabCustomer`.mobile_no,\n          date_format(`tabCustomer`.modified_time, '%%Y-%%m-01'),\n          date_format(`tabCustomer`.next_projected_purchase_date, '%%Y-%%m-01'),\n          `tabCustomer`.owner,\n          `tabCustomer`.pending_bottles,\n          `tabCustomer`.primary_address\n LIMIT 1000000000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Customer Data",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "2vcuhlji64",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 4.424,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Parent Item Name\",\n   \"column\": \"parent_item_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Parent Item Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabPacked Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Total Qty\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Qty\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabPacked Item\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabPacked Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Packed Item\",\n    \"table\": \"tabPacked Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Packed Item\",\n  \"table\": \"tabPacked Item\"\n }\n}",
  "last_execution": "2024-06-10 15:31:35.456743",
  "limit": 500,
  "modified": "2024-06-05 12:04:22.728191",
  "name": "QRY-0025",
  "result_name": "2vcuj8qhe2",
  "results_row_count": 10,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabPacked Item`.parent_item_name AS `Parent Item Name`,\n       sum(`tabPacked Item`.qty) AS `Total Qty`\n  FROM `tabPacked Item` AS `tabPacked Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabPacked Item`.parent = `tabSales Invoice`.name\n GROUP BY `tabPacked Item`.parent_item_name\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Parent Item wise packed item total qty ",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "0tdk0lnbeg",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.047,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise Name\",\n   \"column\": \"franchise_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"asc\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Customer Name\",\n   \"column\": \"customer_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": null,\n    \"alias\": \"Franchise Name\",\n    \"column\": \"franchise_name\",\n    \"expression\": {},\n    \"format\": null,\n    \"granularity\": null,\n    \"label\": \"Franchise Name\",\n    \"meta\": null,\n    \"order\": null,\n    \"table\": \"tabCustomer\",\n    \"type\": \"String\"\n   },\n   \"expression\": {},\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": \"https://jibusyokimau.frappe.cloud/\",\n    \"value\": \"https://jibusyokimau.frappe.cloud/\"\n   }\n  }\n ],\n \"joins\": [],\n \"limit\": 10000000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-06-28 11:44:33.952499",
  "limit": 500,
  "modified": "2024-06-28 11:44:33.981982",
  "name": "QRY-0078",
  "result_name": "0tdkhovct8",
  "results_row_count": 2,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.franchise_name AS `Franchise Name`,\n       `tabCustomer`.referral_company AS `Referral Company`,\n       count(*) AS `Customer Name`\n  FROM `tabCustomer` AS `tabCustomer`\n WHERE `tabCustomer`.franchise_name = 'https://jibusyokimau.frappe.cloud/'\n GROUP BY `tabCustomer`.franchise_name,\n          `tabCustomer`.referral_company\n ORDER BY `tabCustomer`.referral_company ASC\n LIMIT 10000000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Customer With No Referral Company ",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "0bbdjikdin",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 4.096,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer Group Name\",\n   \"column\": \"customer_group_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Group Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Total Qty\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Qty\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabPacked Item\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabPacked Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Packed Item\",\n    \"table\": \"tabPacked Item\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-06-10 15:31:30.920598",
  "limit": 500,
  "modified": "2024-06-05 12:05:15.536026",
  "name": "QRY-0023",
  "result_name": "0bbel81itr",
  "results_row_count": 7,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabSales Invoice`.customer_group_name AS `Customer Group Name`,\n       sum(`tabPacked Item`.qty) AS `Total Qty`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n INNER JOIN `tabPacked Item` AS `tabPacked Item`\n    ON `tabSales Invoice`.name = `tabPacked Item`.parent\n GROUP BY `tabSales Invoice`.customer_group_name\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Customer Group wise Sales Invoice Item Total Qty",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "q8jek9movf",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.327,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-12 15:06:58.913570",
  "limit": 500,
  "modified": "2024-06-10 15:42:29.388064",
  "name": "QRY-0029",
  "result_name": "q8je46bq5g",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT common_customers AS `Customer Who Bought This Month & Last Month`,\n       customers_last_month_only AS `Customer Who Bought Last Month`,\n       CONCAT(ROUND(common_customers / customers_last_month_only * 100, 2), '%') AS `Retention Rate (%)`\n  FROM (\n        SELECT (\n                SELECT COUNT(DISTINCT customer)\n                  FROM `tabSales Invoice`\n                 WHERE YEAR(posting_date) = YEAR(CURRENT_DATE)\n                   AND MONTH(posting_date) = MONTH(CURRENT_DATE)\n                   AND customer IN (\n                        SELECT DISTINCT customer\n                          FROM `tabSales Invoice`\n                         WHERE YEAR(posting_date) = YEAR(CURRENT_DATE - INTERVAL 1 MONTH)\n                           AND MONTH(posting_date) = MONTH(CURRENT_DATE - INTERVAL 1 MONTH)\n                       )\n               ) AS common_customers,\n               (\n                SELECT COUNT(DISTINCT customer)\n                  FROM `tabSales Invoice`\n                 WHERE YEAR(posting_date) = YEAR(CURRENT_DATE - INTERVAL 1 MONTH)\n                   AND MONTH(posting_date) = MONTH(CURRENT_DATE - INTERVAL 1 MONTH)\n               ) AS customers_last_month_only\n       ) AS subquery",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate SQL Query",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "utbhpknq6r",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 2.451,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Item Code Name\",\n   \"column\": \"item_code_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Item Code Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code_name`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-09 14:49:10.117798",
  "limit": 500,
  "modified": "2024-07-22 15:31:41.788459",
  "name": "QRY-0046",
  "result_name": "utbh2hmecv",
  "results_row_count": 630,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.referral_company AS `Franchise`,\n       `tabSales Invoice Item`.item_code_name AS `Item Code Name`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code_name LIKE '%%refill%%'\n GROUP BY `tabCustomer`.referral_company,\n          `tabSales Invoice Item`.item_code_name,\n          `tabCustomer`.type_of_customer\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise SKU Type of Customer WIse Refill Rate",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "npa4el6urb",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 33.422,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Item Code Name\",\n   \"column\": \"item_code_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Item Code Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Weekly\",\n   \"column\": \"posting_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Week\",\n   \"label\": \"Weekly\",\n   \"meta\": null,\n   \"order\": \"desc\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Date\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code_name`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-15 11:17:26.791707",
  "limit": 500,
  "modified": "2024-07-03 11:57:22.319924",
  "name": "QRY-0053",
  "result_name": "npa7tvqhul",
  "results_row_count": 23632,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.referral_company AS `Franchise`,\n       `tabSales Invoice Item`.item_code_name AS `Item Code Name`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) AS `Weekly`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code_name LIKE '%%refill%%'\n GROUP BY `tabCustomer`.referral_company,\n          `tabSales Invoice Item`.item_code_name,\n          `tabCustomer`.type_of_customer,\n          DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY)\n ORDER BY DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) DESC\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise SKU Type of Customer WIse Refill Rate Weekly",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "c2cr2bdptk",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 14.17,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-12 15:07:13.567673",
  "limit": 500,
  "modified": "2024-06-10 17:52:02.970002",
  "name": "QRY-0022",
  "result_name": "c2crpla2l5",
  "results_row_count": 87,
  "script": null,
  "script_log": null,
  "sql": "SELECT si1.franchise_name AS `Franchise`,\n       c.referral_company AS `Referral Company`,\n       COUNT(DISTINCT si1.customer) AS `Customer Who Bought This Month & Last Month`,\n       (\n        SELECT COUNT(DISTINCT si2.customer)\n          FROM `tabSales Invoice` si2\n          JOIN `tabCustomer` c2\n            ON si2.customer = c2.name\n         WHERE MONTH(si2.posting_date) = MONTH(CURRENT_DATE - INTERVAL 1 MONTH)\n           AND COALESCE(c2.referral_company, 'Unknown') = COALESCE(c.referral_company, 'Unknown')\n           AND si2.franchise_name = si1.franchise_name\n       ) AS `Customer Who Bought Last Month`,\n       CONCAT(IFNULL(ROUND((COUNT(DISTINCT si1.customer) / (SELECT COUNT(DISTINCT si2.customer) FROM `tabSales Invoice` si2 JOIN `tabCustomer` c2 ON si2.customer = c2.name WHERE MONTH(si2.posting_date) = MONTH(CURRENT_DATE - INTERVAL 1 MONTH) AND COALESCE(c2.referral_company, 'Unknown') = COALESCE(c.referral_company, 'Unknown') AND si2.franchise_name = si1.franchise_name )) * 100, 2), 0), '%') AS `Retention Rate (%)`\n  FROM `tabSales Invoice` si1\n  JOIN `tabCustomer` c\n    ON si1.customer = c.name\n WHERE MONTH(si1.posting_date) = MONTH(CURRENT_DATE)\n   AND si1.customer IN (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE MONTH(posting_date) = MONTH(CURRENT_DATE - INTERVAL 1 MONTH)\n       )\n GROUP BY si1.franchise_name,\n          c.referral_company",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate Franchise Query",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "ut70l9sa27",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 2.235,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"SKU\",\n   \"column\": \"item_code_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"SKU\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code_name`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-09 14:49:07.243776",
  "limit": 500,
  "modified": "2024-06-13 12:52:24.724215",
  "name": "QRY-0045",
  "result_name": "ut71ee29ag",
  "results_row_count": 34,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabSales Invoice Item`.item_code_name AS `SKU`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code_name LIKE '%%refill%%'\n GROUP BY `tabSales Invoice Item`.item_code_name,\n          `tabCustomer`.type_of_customer\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Average # of refill SKUs per Customer Type ",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "gq1p2qp15n",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.214,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-06-28 11:40:03.764874",
  "limit": 500,
  "modified": "2024-06-28 11:46:32.487708",
  "name": "QRY-0058",
  "result_name": "gq1qq49ldn",
  "results_row_count": -1,
  "script": null,
  "script_log": null,
  "sql": "SELECT Territory,\n       COUNT(DISTINCT(referral_company)) AS Referral Company\n  FROM `tabCustomer`\n WHERE referral_company IS NOT NULL\n   AND referral_company <> ''\n GROUP BY territory",
  "status": "Execution Failed",
  "tables": [],
  "title": "Test SQL Query",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "a1s5rltab6",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 2.66,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-06-28 12:05:36.035683",
  "limit": 500,
  "modified": "2024-06-27 15:20:30.755939",
  "name": "QRY-0074",
  "result_name": "a1s5ht8e2a",
  "results_row_count": 59,
  "script": null,
  "script_log": null,
  "sql": "WITH c_all AS (\n        SELECT territory,\n               COUNT(DISTINCT unique_entity) AS unique_entity_count\n          FROM (\n                SELECT territory,\n                       referral_company AS unique_entity\n                  FROM `tabCustomer`\n                 WHERE referral_company IS NOT NULL\n                 UNION SELECT territory,\n                       franchise_name AS unique_entity\n                  FROM `tabCustomer`\n                 WHERE referral_company IS NULL\n               ) combined_data\n         GROUP BY territory\n       ) SELECT c.territory AS Territory,\n       CONCAT(DATE_FORMAT(t.posting_date, '%M'), ' - ', YEAR(t.posting_date)) AS MonthYear,\n       COUNT(DISTINCT CASE WHEN c.referral_company IS NOT NULL THEN c.referral_company ELSE c.franchise_name END) AS `Daily Active Franchise`,\n       COALESCE(c_all.unique_entity_count, 0) AS `Total Franchises`,\n       CONCAT(ROUND(COUNT(DISTINCT CASE WHEN c.referral_company IS NOT NULL THEN c.referral_company ELSE c.franchise_name END) / NULLIF(COALESCE(c_all.unique_entity_count, 0), 0) * 100, 2), ' %') AS `POS Usage %`\n  FROM `tabPOS Invoice` t\n  LEFT JOIN `tabCustomer` c\n    ON t.customer = c.name\n  LEFT JOIN c_all\n    ON c.territory = c_all.territory\n GROUP BY c.territory,\n          MonthYear\n ORDER BY c.territory,\n          YEAR(t.posting_date) DESC, MONTH(t.posting_date) DESC",
  "status": "Execution Successful",
  "tables": [],
  "title": "POS Usage Monthly",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "n39maqf5ie",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 9.225,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"SKU\",\n   \"column\": \"item_code_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"SKU\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate (%)\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Weekly\",\n   \"column\": \"posting_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Week\",\n   \"label\": \"Weekly\",\n   \"meta\": null,\n   \"order\": \"desc\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Date\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code_name`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-15 11:16:14.401043",
  "limit": 500,
  "modified": "2024-06-13 13:07:48.063495",
  "name": "QRY-0051",
  "result_name": "n39mk3g8a3",
  "results_row_count": 2347,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabSales Invoice Item`.item_code_name AS `SKU`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) AS `Weekly`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate (%%)`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code_name LIKE '%%refill%%'\n GROUP BY `tabSales Invoice Item`.item_code_name,\n          `tabCustomer`.type_of_customer,\n          DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY)\n ORDER BY DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) DESC\n LIMIT 100000000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Average # of refill SKUs per Customer Type  Weekly",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "nogla6otum",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 20.369,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Weekly\",\n   \"column\": \"posting_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Week\",\n   \"label\": \"Weekly\",\n   \"meta\": null,\n   \"order\": \"desc\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Date\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code_name`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-15 11:16:38.559955",
  "limit": 500,
  "modified": "2024-06-13 13:29:26.775931",
  "name": "QRY-0052",
  "result_name": "nogo1aalaq",
  "results_row_count": 8492,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.referral_company AS `Franchise`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) AS `Weekly`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code_name LIKE '%%refill%%'\n GROUP BY `tabCustomer`.referral_company,\n          `tabCustomer`.type_of_customer,\n          DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY)\n ORDER BY DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) DESC\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise Type of Customer WIse Refill Rate Weekly",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "9jr64qfb08",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 2.831,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-06-28 12:05:39.075840",
  "limit": 500,
  "modified": "2024-06-27 15:18:26.558603",
  "name": "QRY-0073",
  "result_name": "9jr6gaj3ub",
  "results_row_count": 1272,
  "script": null,
  "script_log": null,
  "sql": "WITH c_all AS (\n        SELECT territory,\n               COUNT(DISTINCT unique_entity) AS unique_entity_count\n          FROM (\n                SELECT territory,\n                       referral_company AS unique_entity\n                  FROM `tabCustomer`\n                 WHERE referral_company IS NOT NULL\n                 UNION SELECT territory,\n                       franchise_name AS unique_entity\n                  FROM `tabCustomer`\n                 WHERE referral_company IS NULL\n               ) combined_data\n         GROUP BY territory\n       ) SELECT c.territory AS Territory,\n       DATE(t.posting_date) AS DAY,\n       COUNT(DISTINCT CASE WHEN c.referral_company IS NOT NULL THEN c.referral_company ELSE c.franchise_name END) AS `Daily Active Franchise`,\n       COALESCE(c_all.unique_entity_count, 0) AS `Total Franchises`,\n       CONCAT(ROUND(COUNT(DISTINCT CASE WHEN c.referral_company IS NOT NULL THEN c.referral_company ELSE c.franchise_name END) / NULLIF(COALESCE(c_all.unique_entity_count, 0), 0) * 100, 2), ' %') AS `POS Usage %`\n  FROM `tabPOS Invoice` t\n  LEFT JOIN `tabCustomer` c\n    ON t.customer = c.name\n  LEFT JOIN c_all\n    ON c.territory = c_all.territory\n GROUP BY c.territory,\n          DATE(t.posting_date)\n ORDER BY c.territory,\n          DATE(t.posting_date) DESC",
  "status": "Execution Successful",
  "tables": [],
  "title": "Daily POS Usage SQL",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "g27hc2nrjp",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.277,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-09 11:54:40.032219",
  "limit": 500,
  "modified": "2024-06-14 13:09:38.111978",
  "name": "QRY-0057",
  "result_name": "g27mpsd48k",
  "results_row_count": 9,
  "script": null,
  "script_log": null,
  "sql": "SELECT tc.type_of_customer AS \"Type of Customer\",\n       COUNT(DISTINCT CASE WHEN tw.customer IS NOT NULL THEN tw.customer END) AS \"Customers Who Bought These Two Week & Last Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought Last Two Week Only\",\n       CONCAT(ROUND((COUNT(DISTINCT CASE WHEN tw.customer IS NOT NULL THEN tw.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END), 0)) * 100, 2), '%') AS \"Retention Rate\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 9) DAY, '%d-%m-%Y')) AS \"Last Two Week\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y')) AS \"These Two Week\"\n  FROM (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY\n           AND posting_date <= CURDATE() - INTERVAL WEEKDAY(CURDATE()) + 9 DAY\n       ) AS lw\n  LEFT JOIN (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY\n           AND posting_date <= CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY\n       ) AS tw\n    ON lw.customer = tw.customer\n  LEFT JOIN `tabCustomer` tc\n    ON lw.customer = tc.name\n GROUP BY tc.type_of_customer",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate weekly with Type of Customer",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "ft41cq9t6t",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.279,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-14 15:09:06.210060",
  "limit": 500,
  "modified": "2024-06-14 13:08:46.823572",
  "name": "QRY-0056",
  "result_name": "ft446cn50e",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT COUNT(DISTINCT CASE WHEN tw.customer IS NOT NULL THEN tw.customer END) AS \"Customers Who Bought These Two Week & Last Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought Last Two Week Only\",\n       CONCAT(ROUND((COUNT(DISTINCT CASE WHEN tw.customer IS NOT NULL THEN tw.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END), 0)) * 100, 2), '%') AS \"Retention Rate\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 9) DAY, '%d-%m-%Y')) AS \"Last Two Week\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y')) AS \"These Two Week\"\n  FROM (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY\n           AND posting_date <= CURDATE() - INTERVAL WEEKDAY(CURDATE()) + 9 DAY\n       ) AS lw\n  LEFT JOIN (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY\n           AND posting_date <= CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY\n       ) AS tw\n    ON lw.customer = tw.customer",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate Weekly",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "utfim2m3qv",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.259,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code_name`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-09 14:49:07.598079",
  "limit": 500,
  "modified": "2024-06-12 14:56:48.095526",
  "name": "QRY-0047",
  "result_name": "utfjbvhucl",
  "results_row_count": 158,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.referral_company AS `Franchise`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code_name LIKE '%%refill%%'\n GROUP BY `tabCustomer`.referral_company,\n          `tabCustomer`.type_of_customer\n LIMIT 10000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise Type of Customer WIse Refill Rate",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "ivcm2ng7ti",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 2.331,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"SKU\",\n   \"column\": \"item_code_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"SKU\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Posting Date\",\n   \"column\": \"posting_date\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"Week\",\n   \"label\": \"Posting Date\",\n   \"meta\": null,\n   \"order\": \"desc\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Date\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Transactions Distinct\",\n   \"column\": \"name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Transactions Distinct\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customers\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Frequency\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"name\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"distinct_count(`tabSales Invoice.name`)/distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Frequency\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_code_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_code_name`,\\\"refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice Item\",\n  \"table\": \"tabSales Invoice Item\"\n }\n}",
  "last_execution": "2024-08-09 14:54:45.251169",
  "limit": 500,
  "modified": "2024-06-13 13:10:09.275252",
  "name": "QRY-0048",
  "result_name": "ivcnajitlr",
  "results_row_count": 22531,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.referral_company AS `Franchise`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       `tabSales Invoice Item`.item_code_name AS `SKU`,\n       DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) AS `Posting Date`,\n       count(DISTINCT `tabSales Invoice`.name) AS `Transactions Distinct`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customers`,\n       count(DISTINCT `tabSales Invoice`.name) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Frequency`\n  FROM `tabSales Invoice Item` AS `tabSales Invoice Item`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabSales Invoice Item`.parent = `tabSales Invoice`.name\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_code_name LIKE '%%refill%%'\n GROUP BY `tabCustomer`.referral_company,\n          `tabCustomer`.type_of_customer,\n          `tabSales Invoice Item`.item_code_name,\n          DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY)\n ORDER BY DATE_SUB(date_format(`tabSales Invoice`.posting_date, '%%Y-%%m-%%d'), INTERVAL (DAYOFWEEK(`tabSales Invoice`.posting_date) - 1) DAY) DESC\n LIMIT 10000000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Refill Frequency Weekly",
  "transforms": [
   {
    "options": "{}",
    "parent": "QRY-0048",
    "parentfield": "transforms",
    "parenttype": "Insights Query",
    "type": ""
   }
  ],
  "variables": []
 },
 {
  "chart": "upedov7c5c",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 4.738,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Item Code Name\",\n   \"column\": \"item_code_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Item Code Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Item Name Qty\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IF(item_code_name REGEXP '^[^0-9]', 1, IF(item_code_name REGEXP '[0-9]+ML[^0-9]', CAST(REGEXP_REPLACE(item_code_name, '[^0-9]', '') AS DECIMAL(10, 2))/1000, CAST(SUBSTRING_INDEX(item_code_name, ' ', 1) AS DECIMAL(10, 2)))) AS `Item Name Qty`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IF(item_code_name REGEXP '^[^0-9]', 1, IF(item_code_name REGEXP '[0-9]+ML[^0-9]', CAST(REGEXP_REPLACE(item_code_name, '[^0-9]', '') AS DECIMAL(10, 2))/1000, CAST(SUBSTRING_INDEX(item_code_name, ' ', 1) AS DECIMAL(10, 2)))) AS `Item Name Qty`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Item Name Qty\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Invoice Item Qty\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Invoice Item Qty\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Total Quantity\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IF(item_code_name REGEXP '^[^0-9]', 1, IF(item_code_name REGEXP '[0-9]+ML[^0-9]', CAST(REGEXP_REPLACE(item_code_name, '[^0-9]', '') AS DECIMAL(10, 2))/1000, CAST(SUBSTRING_INDEX(item_code_name, ' ', 1) AS DECIMAL(10, 2)))) * sum(`tabSales Invoice Item`.qty) AS `Total Quantity` \"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IF(item_code_name REGEXP '^[^0-9]', 1, IF(item_code_name REGEXP '[0-9]+ML[^0-9]', CAST(REGEXP_REPLACE(item_code_name, '[^0-9]', '') AS DECIMAL(10, 2))/1000, CAST(SUBSTRING_INDEX(item_code_name, ' ', 1) AS DECIMAL(10, 2)))) * sum(`tabSales Invoice Item`.qty) AS `Total Quantity` \\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Quantity\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-16 15:35:18.094875",
  "limit": 500,
  "modified": "2024-06-12 14:45:31.308289",
  "name": "QRY-0042",
  "result_name": "upeemhfdc8",
  "results_row_count": 1637,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.referral_company AS `Referral Company`,\n       `tabSales Invoice Item`.item_code_name AS `Item Code Name`,\n       IF(item_code_name REGEXP '^[^0-9]', 1, IF(item_code_name REGEXP '[0-9]+ML[^0-9]', CAST(REGEXP_REPLACE(item_code_name, '[^0-9]', '') AS DECIMAL(10, 2))/1000, CAST(SUBSTRING_INDEX(item_code_name, ' ', 1) AS DECIMAL(10, 2)))) AS `Item Name Qty`,\n       sum(`tabSales Invoice Item`.qty) AS `Invoice Item Qty`,\n       IF(item_code_name REGEXP '^[^0-9]', 1, IF(item_code_name REGEXP '[0-9]+ML[^0-9]', CAST(REGEXP_REPLACE(item_code_name, '[^0-9]', '') AS DECIMAL(10, 2))/1000, CAST(SUBSTRING_INDEX(item_code_name, ' ', 1) AS DECIMAL(10, 2)))) * sum(`tabSales Invoice Item`.qty) AS `Total Quantity`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n INNER JOIN `tabSales Invoice Item` AS `tabSales Invoice Item`\n    ON `tabSales Invoice`.name = `tabSales Invoice Item`.parent\n GROUP BY `tabCustomer`.referral_company,\n          `tabSales Invoice Item`.item_code_name\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Product Sale Per Franchise",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "agbab4b9gj",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.67,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-12 15:06:59.271512",
  "limit": 500,
  "modified": "2024-06-12 14:29:44.133732",
  "name": "QRY-0032",
  "result_name": "agbale0djv",
  "results_row_count": 162,
  "script": null,
  "script_log": null,
  "sql": "WITH current_month_customers AS (\n        SELECT DISTINCT si.customer,\n               c.referral_company\n          FROM `tabSales Invoice` si\n          JOIN `tabCustomer` c\n            ON si.customer = c.name\n         WHERE si.posting_date >= DATE_FORMAT(CURDATE(), '%Y-%m-01')\n           AND si.posting_date < DATE_FORMAT(CURDATE() + INTERVAL 1 MONTH, '%Y-%m-01')\n       ),\n       previous_month_customers AS (\n        SELECT DISTINCT si.customer,\n               c.referral_company\n          FROM `tabSales Invoice` si\n          JOIN `tabCustomer` c\n            ON si.customer = c.name\n         WHERE si.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01')\n           AND si.posting_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')\n       ),\n       both_months_customers AS (\n        SELECT pmc.customer,\n               pmc.referral_company\n          FROM previous_month_customers pmc\n          JOIN current_month_customers cmc\n            ON pmc.customer = cmc.customer\n       ),\n       franchises AS (\n        SELECT referral_company\n          FROM `tabCustomer`\n         GROUP BY referral_company\n       ) SELECT f.referral_company AS 'Franchise',\n       COUNT(bmc.customer) AS 'Customer Who Bought This Month & Last Month',\n       COUNT(pmc.customer) AS 'Customer Who Bought Last Month',\n       CONCAT(FORMAT((COUNT(bmc.customer) * 100.0 / NULLIF(COUNT(pmc.customer), 0)), 2), '%') AS 'Retention Rate (%)'\n  FROM franchises f\n  LEFT JOIN previous_month_customers pmc\n    ON f.referral_company = pmc.referral_company\n  LEFT JOIN both_months_customers bmc\n    ON pmc.customer = bmc.customer\n GROUP BY f.referral_company",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate SQL Query Franchise Wise ",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "dfmjf0td6k",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.766,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-09 11:54:41.466454",
  "limit": 500,
  "modified": "2024-06-14 13:10:52.298317",
  "name": "QRY-0035",
  "result_name": "dfmja5obc0",
  "results_row_count": 453,
  "script": null,
  "script_log": null,
  "sql": "SELECT c.referral_company AS \"Franchise\",\n       c.type_of_customer AS \"Type of Customer\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 9) DAY, '%d-%m-%Y')) AS \"Last Two Week\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y')) AS \"These Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL AND tw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought This Week & Last Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought Last Week Only\",\n       CONCAT(ROUND(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL AND tw.customer IS NOT NULL THEN lw.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END), 0) * 100, 2), '%') AS \"Retention Rate\"\n  FROM (\n        SELECT DISTINCT name,\n               type_of_customer,\n               referral_company\n          FROM `tabCustomer`\n       ) AS c\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY\n           AND posting_date <= CURDATE() - INTERVAL WEEKDAY(CURDATE()) + 9 DAY\n       ) AS lw\n    ON c.name = lw.customer\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY\n           AND posting_date <= CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY\n       ) AS tw\n    ON c.name = tw.customer\n GROUP BY c.referral_company,\n          c.type_of_customer",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate Weekly with Type Of Customer",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "fn8ptc0hl7",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.579,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-09 11:54:40.589882",
  "limit": 500,
  "modified": "2024-06-14 13:10:16.402264",
  "name": "QRY-0055",
  "result_name": "fn8s53s2dk",
  "results_row_count": 162,
  "script": null,
  "script_log": null,
  "sql": "SELECT c.referral_company AS \"Franchise\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 9) DAY, '%d-%m-%Y')) AS \"Last Two Week\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y')) AS \"These Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL AND tw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought These Two Week & Last Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought Last Two Week Only\",\n       CONCAT(ROUND(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL AND tw.customer IS NOT NULL THEN lw.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END), 0) * 100, 2), '%') AS \"Retention Rate\"\n  FROM (\n        SELECT DISTINCT name,\n               referral_company\n          FROM `tabCustomer`\n       ) AS c\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 22) DAY\n           AND posting_date <= CURDATE() - INTERVAL WEEKDAY(CURDATE()) + 9 DAY\n       ) AS lw\n    ON c.name = lw.customer\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY\n           AND posting_date <= CURDATE() + INTERVAL (5 - WEEKDAY(CURDATE())) DAY\n       ) AS tw\n    ON c.name = tw.customer\n GROUP BY c.referral_company",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise Wise Retention Rate Weekly",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "uvc9bm2afc",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 4.074,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-13 13:19:28.084144",
  "limit": 500,
  "modified": "2024-06-28 13:11:37.631200",
  "name": "QRY-0076",
  "result_name": "uvcbrp6c3u",
  "results_row_count": 1442,
  "script": null,
  "script_log": null,
  "sql": "WITH total_unique_referrals AS (\n        SELECT territory,\n               COUNT(DISTINCT referral_company) AS total_unique_franchises\n          FROM `tabCustomer`\n         WHERE referral_company IS NOT NULL\n         GROUP BY territory\n       ),\n       active_unique_referrals AS (\n        SELECT t.territory,\n               DATE(t.posting_date) AS posting_date,\n               COUNT(DISTINCT c.referral_company) AS active_unique_franchises\n          FROM `tabPOS Invoice` t\n         INNER JOIN `tabCustomer` c\n            ON t.customer = c.name\n         WHERE c.referral_company IS NOT NULL\n         GROUP BY t.territory,\n                  DATE(t.posting_date)\n       ) SELECT tu.territory AS `Territory`,\n       tu.total_unique_franchises AS `Total Unique Franchises`,\n       ar.posting_date AS `Date`,\n       ar.active_unique_franchises AS `Active Unique Franchses`,\n       CONCAT(ROUND(ar.active_unique_franchises / CAST(tu.total_unique_franchises AS DECIMAL(10,2)) * 100, 2), ' %') AS `POS Usage (%)`\n  FROM total_unique_referrals tu\n  JOIN active_unique_referrals ar\n    ON tu.territory = ar.territory\n ORDER BY tu.territory,\n          ar.posting_date",
  "status": "Execution Successful",
  "tables": [],
  "title": "Daily POS Usage SQL Excluding Null Referral Company",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "45hnba8dd6",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 1.166,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise Country\",\n   \"column\": \"territory\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise Country\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"This Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"These Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Last Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Previous Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought This Week & Last Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought This Week & Last Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"c\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought Last Week Only\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Retention Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Retention Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-16 16:14:17.969742",
  "limit": 500,
  "modified": "2024-08-16 15:18:06.969985",
  "name": "QRY-0070",
  "result_name": "45hpbamjov",
  "results_row_count": 444,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.territory AS `Franchise Country`,\n       `tabCustomer`.referral_company AS `Referral Company`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%%d-%%m-%%Y')) AS `These Two Weeks`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%%d-%%m-%%Y')) AS `Previous Two Weeks`,\n       IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`,\n       IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought Last Two Week Only`,\n       CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%%') AS `Retention Rate`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n  LEFT OUTER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n GROUP BY `tabCustomer`.territory,\n          `tabCustomer`.referral_company,\n          `tabCustomer`.type_of_customer\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate Visual Query dynamic Franchise Wise Type Of Customer(Weekly)",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "0a79dv45qd",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 2.001,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-13 13:19:23.921900",
  "limit": 500,
  "modified": "2024-06-28 13:09:59.223203",
  "name": "QRY-0077",
  "result_name": "0a7bkq2565",
  "results_row_count": 56,
  "script": null,
  "script_log": null,
  "sql": "WITH total_unique_referrals AS (\n        SELECT territory,\n               COUNT(DISTINCT referral_company) AS total_unique_franchises\n          FROM `tabCustomer`\n         WHERE referral_company IS NOT NULL\n         GROUP BY territory\n       ),\n       active_unique_referrals AS (\n        SELECT c.territory,\n               DATE_FORMAT(t.posting_date, '%M %Y') AS posting_month,\n               COUNT(DISTINCT c.referral_company) AS active_unique_franchises\n          FROM `tabPOS Invoice` t\n         INNER JOIN `tabCustomer` c\n            ON t.customer = c.name\n         WHERE c.referral_company IS NOT NULL\n         GROUP BY c.territory,\n                  DATE_FORMAT(t.posting_date, '%Y-%m')\n       ) SELECT tu.territory AS `Territory`,\n       tu.total_unique_franchises AS `Total Unique Franchise`,\n       ar.posting_month AS `Month`,\n       ar.active_unique_franchises AS `Active Unique Franchises`,\n       CONCAT(ROUND(ar.active_unique_franchises / CAST(tu.total_unique_franchises AS DECIMAL(10,2)) * 100, 2), ' %') AS `POS Usage (%)`\n  FROM total_unique_referrals tu\n  JOIN active_unique_referrals ar\n    ON tu.territory = ar.territory\n ORDER BY tu.territory,\n          ar.posting_month",
  "status": "Execution Successful",
  "tables": [],
  "title": "Monthly POS Usage Excluding Null Referral Company",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "ef1el37rs5",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 1.219,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise Country\",\n   \"column\": \"territory\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise Country\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"This Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"These Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Last Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Previous Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought This Week & Last Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought This Week & Last Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"c\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought Last Week Only\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Retention Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Retention Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-16 16:14:16.722005",
  "limit": 500,
  "modified": "2024-08-16 15:15:44.661124",
  "name": "QRY-0064",
  "result_name": "ef1he2o7kv",
  "results_row_count": 158,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.territory AS `Franchise Country`,\n       `tabCustomer`.referral_company AS `Referral Company`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%%d-%%m-%%Y')) AS `These Two Weeks`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%%d-%%m-%%Y')) AS `Previous Two Weeks`,\n       IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`,\n       IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought Last Two Week Only`,\n       CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%%') AS `Retention Rate`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n  LEFT OUTER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n GROUP BY `tabCustomer`.territory,\n          `tabCustomer`.referral_company\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate Visual Query dynamic Franchise Wise(Weekly)",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "8qhu7acs6t",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.221,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": null,\n    \"alias\": \"Posting Date\",\n    \"column\": \"posting_date\",\n    \"expression\": {},\n    \"format\": null,\n    \"granularity\": null,\n    \"label\": \"Posting Date\",\n    \"meta\": null,\n    \"order\": null,\n    \"table\": \"tabPOS Invoice\",\n    \"type\": \"Date\"\n   },\n   \"expression\": {},\n   \"operator\": {\n    \"label\": \"within\",\n    \"value\": \"timespan\"\n   },\n   \"value\": {\n    \"label\": \"Current Month\",\n    \"value\": \"Current Month\"\n   }\n  },\n  {\n   \"column\": {\n    \"aggregation\": null,\n    \"alias\": \"Territory\",\n    \"column\": \"territory\",\n    \"expression\": {},\n    \"format\": null,\n    \"granularity\": null,\n    \"label\": \"Territory\",\n    \"meta\": null,\n    \"order\": null,\n    \"table\": \"tabCustomer\",\n    \"type\": \"String\"\n   },\n   \"expression\": {},\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": \"Congo, The Democratic Republic of the\",\n    \"value\": \"Congo, The Democratic Republic of the\"\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabPOS Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Pos Invoice\",\n    \"table\": \"tabPOS Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Pos Invoice\",\n  \"table\": \"tabPOS Invoice\"\n }\n}",
  "last_execution": "2024-06-28 13:05:46.075078",
  "limit": 500,
  "modified": "2024-06-28 13:05:46.107028",
  "name": "QRY-0072",
  "result_name": "8qhvjqrt5t",
  "results_row_count": 10,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.referral_company AS `Referral Company`\n  FROM `tabPOS Invoice` AS `tabPOS Invoice`\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabPOS Invoice`.customer = `tabCustomer`.name\n WHERE `tabPOS Invoice`.posting_date BETWEEN '2024-06-01 00:00:00' AND '2024-06-30 23:59:59'\n   AND `tabCustomer`.territory = 'Congo, The Democratic Republic of the'\n GROUP BY `tabCustomer`.referral_company\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Territory Query",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "429di36nqv",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 1.136,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought This Week & Last Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought This Week & Last Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"c\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought Last Week Only\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"This Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"These Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Previous Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Previous Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Retention Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Retention Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-16 16:14:20.395323",
  "limit": 500,
  "modified": "2024-08-16 15:22:00.300901",
  "name": "QRY-0068",
  "result_name": "429gk0upqs",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`,\n       IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought Last Two Week Only`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%%d-%%m-%%Y')) AS `These Two Weeks`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%%d-%%m-%%Y')) AS `Previous Two Weeks`,\n       CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%%') AS `Retention Rate`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n  LEFT OUTER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate Visual Query dynamic Franchise Wise(Weekly)",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "42sdt1krp1",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 1.159,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought This Week & Last Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought This Week & Last Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"c\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Two Week Only`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought Last Week Only\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"This Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%d-%m-%Y')) AS `These Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"These Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Previous Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%d-%m-%Y')) AS `Previous Two Weeks`\\\") \"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Previous Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Retention Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS `Retention Rate`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Retention Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-16 16:14:19.200669",
  "limit": 500,
  "modified": "2024-08-16 15:18:54.588058",
  "name": "QRY-0069",
  "result_name": "42sflqkbb8",
  "results_row_count": 11,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought These Two Week & Last Two Week`,\n       IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought Last Two Week Only`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 1) DAY, '%%d-%%m-%%Y')) AS `These Two Weeks`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY, '%%d-%%m-%%Y')) AS `Previous Two Weeks`,\n       CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 14) DAY AND `tabSales Invoice`.posting_date <= CURDATE() + INTERVAL (1 + WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date <= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 15) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 28) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%%') AS `Retention Rate`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n  LEFT OUTER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n GROUP BY `tabCustomer`.type_of_customer\n LIMIT 100000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate Visual Query dynamic Franchise Wise Type Of Customer wise (Weekly)",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "ak9v3lhfpk",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.061,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"distinct_count\",\n   \"alias\": \"Customer\",\n   \"column\": \"customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": null,\n    \"alias\": \"Posting Date\",\n    \"column\": \"posting_date\",\n    \"expression\": {},\n    \"format\": null,\n    \"granularity\": null,\n    \"label\": \"Posting Date\",\n    \"meta\": null,\n    \"order\": null,\n    \"table\": \"tabSales Invoice\",\n    \"type\": \"Date\"\n   },\n   \"expression\": {},\n   \"operator\": {\n    \"label\": \"between\",\n    \"value\": \"between\"\n   },\n   \"value\": {\n    \"label\": \"May 19, 2024 to Jun 1, 2024\",\n    \"value\": \"2024-05-19,2024-06-01\"\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 10000000000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-06-14 13:20:12.017608",
  "limit": 500,
  "modified": "2024-06-14 13:20:12.038001",
  "name": "QRY-0033",
  "result_name": "ak9v7dkbhf",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT count(DISTINCT `tabSales Invoice`.customer) AS `Customer`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice`.posting_date BETWEEN '2024-05-19 00:00:00' AND '2024-06-01 23:59:59'\n LIMIT 10000000000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Test Visual Query",
  "transforms": [],
  "variables": []
 }
]